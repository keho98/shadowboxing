<!DOCTYPE HTML>
<html>
    <head>
        <script type="text/javascript" src="js/kinect.js"></script>
    </head>

    <body>
        <canvas id="jointTracker" width="640" height="480"></canvas>  
        <script type="text/javascript">
        var canvas, ctx;
        var scream = true;

        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('jointTracker');
            ctx    = canvas.getContext('2d');
        });   

        // Step One: Set Up KinectJS
        // Joints you want to track
        var JOINTS = ['HEAD','HAND_LEFT','HAND_RIGHT'];

        // A helper function we'll want to use later with coordinates
        var jnt = function(j) { return JOINTS.indexOf(j); }

        kinect.setUp({
            players:  1,                    // # of players, max = 2
            joints:   JOINTS,               // array of joints to track
        })
        .sessionPersist()
        .modal.make('css/knctModal.css')    // Green modal connection bar
        .notif.make();
        // Step Two: Register a joints event listener
        kinect.onMessage(function() {
            // As this function is called on every joint update, clear the canvas first.
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            this.sk_len;    // # of people in the frame
            this.coords;    // A 2D array[m][n] of (x, y, z) coordinates of joints.
            var d = distance(this.coords[0][jnt('HEAD')].x,this.coords[0][jnt('HAND_LEFT')].x,this.coords[0][jnt('HEAD')].y,this.coords[0][jnt('HAND_LEFT')].y);
            var d2 = distance(this.coords[0][jnt('HEAD')].x,this.coords[0][jnt('HAND_RIGHT')].x,this.coords[0][jnt('HEAD')].y,this.coords[0][jnt('HAND_RIGHT')].y);
            var avg = (d + d2)/2;
            console.log(avg);
            if(avg < 40){
                scream = true;
            }
            else scream = false;
            for(var i = 0; i < JOINTS.length; i++){
                var centerX = this.coords[0][i].x;
                var centerY = this.coords[0][i].y;
                ctx.beginPath();
                ctx.arc(centerX, centerY, 10, 0, 2 * Math.PI, false);
                if(scream) {
                    ctx.fillStyle = 'red';
                }
                else{
                    ctx.fillStyle = 'blue'
                }
                ctx.fill(); 
            }
        });

        function distance(x,x1,y,y1){
            return Math.sqrt((x-x1) * (x-x1) + (y-y1) * (y-y1))
        }
        // Step Three: Draw a circle for each joint

        // Step Four: Connect your circles to form a skeleton

        // Bonus Step Five: Track multiple people

        </script>
    </body>
</html>